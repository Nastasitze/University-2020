**Министерство науки и высшего образования Российской Федерации**

**Федеральное государственное бюджетное образовательное учреждение высшего образования**

**«Костромской государственный университет» (КГУ)**

**Институт автоматизированных систем и технологий**

**Направление подготовки: 09.03.02 Информационные системы и технологии**

**Профиль: Информационнные системы и технологии в медиаиндустрии**

**Выполнил студент: Дударева А.Д.**

**Номер группы: 20-ИМбо-3**

**Номер студента: 05**

**Лабораторная работа № 6** 

**Тема: "Firewall в Linux"**

---

#### Раздел 1. Перечень команд

---
> **sudo su** - получили права суперпользователя у VM1;

> **systemctl restart isc-dhcp-server** - перезапуск сервиса *isc-dhcp-server*; 

> **systemctl status isc-dhcp-server** - посмотреть состояние и вывод службы *isc-dhcp-server*;   

> **mkdir iptables-conf** - создали каталог *iptables-conf*;  

> **mc** - используем midnight commander для редактирования файл /etc/sysctl.conf;  
```
/*Раскоменнтировали данную строку:*/
net.ipv4.ip_forward=1 /*Данный параметр разрешает проходить пакетам через этот компьютер. */
/* Использется для настройки роутеров. */
```

> **iptables -A FORWARD -s 192.168.111.0/24 -j ACCEPT** - разрешили прохождение пакетов между сетевыми интерфейсами
из локальной сети *192.168.111.0/24*.    
> 
> > *-A* - добавить правило в цепочку.  
> > *FORWARD* - цепочка, которая применяется для проходящих соединений. Сюда попадают пакеты, отправленные на компьютер, но не предназначены ему.  
> > *-s* - указать ip адрес (*192.168.111.0/24*) устройства-отправителя пакета.  
> > *-j* - выбрать действие, если правило подошло.  
> > *ACCEPT* - разрешить прохождение пакета дальше по цепочке правил;  
  
  
> **iptables -A FORWARD -d 192.168.111.0/24 -j ACCEPT** - разрешили прохождение пакетов между сетевыми интерфейсами
в локальную сеть *192.168.111.0/24*.    
>
> > *-d* - указать ip адрес (*192.168.111.0/24*) получателя;

> **iptables -t nat -A POSTROUTING -o enp0s3 -s 192.168.111.0/24 -j MASQUERADE** - включили маскарад для сети *192.168.111.0/24*.   
> 
> > **Маскарадинг - это подмена некоторых параметров в заголовках IP-пакетов, позволяющая машинам, не имеющим реальных IP-адресов, практически полноценно работать в интернете.**  
> > *-t nat* - для пакетов, устанавливающий новое соединение.  
> > *POSTROUTING* - изменение всех исходящих, предназначенные для передачи на другие узлы сети.  
> > *-o* - указывает исходящий сетевой интерфейс. В нашем случае интерфейс - *enp0s3*.  
> > *-s* - указать ip адрес (*192.168.111.0/24*) устройства-отправителя пакета.  
> > *-j* - выбрать действие, если правило подошло.  
> > *MASQUERADE* - заменяет (маскирует) частный IP-адрес узла внешним IP-адресом шлюза (IP-маскарадингом).  

> **iptables-save** - сохраняем правила межсетевого экрана Netfilter. Данный пакет записывает текущую конфигурацию в файл с указанным именем. 

> **cd /etc/iptables-conf** -  переместились в директорию */etc/iptables-conf*;

> **iptables-save >> iptables.ipv4** - сохранили правила *firewall* в файл *iptables.ipv4*;

> **cd /etc/systemd/system** -  переместились в директорию */etc/systemd/system*;

> **>> iptables-firewall.service** - направили поток вывода в файл *iptables-firewall.service*.  
> Так как файл *iptables-firewall.service* не существует |=> создаем его.
   
> **chmod 755 iptables-firewall.service** - установили права доступа для файла *iptables-firewall.service*.    
> > (1) *7* - чтение запись и выполнение. (1) - владелец.  
> > (2,3) *5* - чтение и выполнение. (2) - группа, (3) - остальные.
> > *755* - все для владельца, остальным только чтение и выполнение;

> **mc** - используем midnight commander для редактирования файл */etc/system/system/iptables-firewall.service*;
 ```javascript 
[Unit]                  /*Содержит общую информацию о сервисе, его описание.*/
  Description=iptables firewall service /*Описание юнита; задаем имя*/
  After=network.target  /*Запускать юнит после группы сервисов network.target*/
[Service]               /*Содержит информацию информация о нашем сервисе.*/
  Type=oneshot          /*Служба выполняет одно задание и завершается*/
  ExecStart=/sbin/iptables-restore /etc/iptables-conf/iptables.ipv4  /*Указывает на исполняемый файл нашего сервиса.*/
  RemainAfterExit=true  /*Предписывает systemd считать процесс активным после его завершения.*/
  StandardOutput=journal
[Install]               /*Содержит информацию о цели, в которой сервис должен стартовать.*/
  WantedBy=multi-user.target  /*Сервис должен быть запущен, когда будет активирована цель multi–user.target.*/
```

> **systemctl daemon-reload** - перечитали конфигурацию процессов типа *daemon*;  

> **systemctl enable iptables-firewall** - включить *iptables-firewall* (опция *enable*), добавив его в автозапуск; 

> **reboot** - перезапустили машину;

> **iptables -L** - посмотреле список правил *iptables* (опция - *-L*);  

> **ping google.com** *(ping 8.8.8.8)* - проверели доступность к интернету;

> **ping 192.168.111.111** - проверили доступность к VM2, адаптер которой наодится в сети *192.168.111.0/24*; 


---

#### Раздел 2. Ответы на вопросы

---

#### Раздел 3. Выводы

---

Таким образом, мы изучили функции сетевого подключения через NAT в среде виртуализации Oracle
VirtualBox, а также осуществили  настройки маршрутизации транзитных IP-пакетов (не предназначенных для
этого компьютера) или IP-форвардинга на ОС Linux.
