**Министерство науки и высшего образования Российской Федерации**

**Федеральное государственное бюджетное образовательное учреждение высшего образования**

**«Костромской государственный университет» (КГУ)**

**Институт автоматизированных систем и технологий**

**Направление подготовки: 09.03.02 Информационные системы и технологии**

**Профиль: Информационнные системы и технологии в медиаиндустрии**

**Выполнил студент: Дударева А.Д.**

**Номер группы: 20-ИМбо-3**

**Номер студента: 05**

**Лабораторная работа № 12** 

**Тема: "Основы Docker"**

-----
#### Раздел 1. Перечень команд
> **sudo su** - получили права суперпользователя;

> **/home/dudsmir/scr5.sh** - создали пустой файл *scr5.sh* для скрипта в каталоге */home/dudsmir*;  

> **chmod +x ./scr5.sh** - сделали файл со скриптом *scr5.sh* исполняемым;  

> **mc** - запуск Midnight Commander;  

```javascript
#!/bin/bash    /* указываем оболочку первой строкой внутри файла скрипта, которую мы собираемся использовать */
 if [-n "$1"]   /* проверяем условие наличия вводимого параметра */
 then 		 /*далее мы проверяем, какой параметр был введен:*/
	case "$1" in 		/* если был введен параметр 'start', то запускаем контейнеры posgresql (pg_test)*/ 
				/* и pgadmin (pg_admin): */
	start) /* 'docker' - это инструмент, с помощью которого можно запускать разные приложения в изолированных контейнерах на одном сервере. */
	       
	       mkdir /home/dudsmir/lab12/pgadmin | chmod -R 777 *
	       mkdir /home/dudsmir/lab12/logs | chmod -R 777 *
	       docker-compose up
	       docker-compose logs pg_admin >> /home/dudsmir/lab12/logs/file_a.txt
	       docker-compose logs pg_test >> /home/dudsmir/lab12/logs/file_t.txt ;;
	       
	       
	       
	/* если был введен параметр 'stop', то запускаем контейнеры posgresql (pg_test) и pgadmin (pg_admin): */
	stop) docker stop pg_test		/* 'stop' - остановили работу контейнеров "pg_test" и "pg_admin". */
	      docker rm pg_test			/* 'rm' - удалили контейнеры "pg_test" и "pg_admin". */
	      docker stop pg_admin
	      docker rm pg_admin
	      
	      rm -r pgadmin			/* 'rm -r' - удалили директорию "pgadmin" и весь контент в нем (опция - '-r') */
	      rm /home/dudsmir/lab12/logs/*.*	/* 'rm' - удалили все файлы (*.*) из каталога /home/dudsmir/lab12/logs/*.* */
	      rmdir logs ;;			/* 'rmdir' - удалили каталог "logs". */
	      
	*) docker ps ;;		/* Если был введен другой параметр (отличный от 'start' или 'stop' ), */
	esac			/* то с помощью опции 'ps' выводим посмотрели список всех активных контейнеров (их статус).*/
	shift
  
 /* Обработка исключения и вывод сообщения, когда скрипт был вызван без параметра */
 else echo "input is null" 
 fi
```

> **mc** - запуск Midnight Commander;  

> **touch docker-compose.yml** - создали compose-файл "docker-compose.yml" в каталоге "/home/dudsmir/lab12/";

```javascript
version: "3.3"
services:

  /* Создаем контенерй "pg_test" */
  pg_test:
    container_name: pg_test	/* Инициализируется имя контейнера - "pg_test" */
    image: postgres:13.3	/* Контейнер создается на основе образа "postgres:13.3" */
    environment:
      POSTGRES_DB: "postgres"		/* Задаем имя БД для контейнера. */
      POSTGRES_USER: "postgres"		/* Задаем пользователя (его имя) - "postgres". */
      POSTGRES_PASSWORD: "pgadmin"	/* Задаем пароль для пользователя. */
    ports: 		/* Задаем локальный и внешний порт.*/
      - "5432:5432"
    volumes:		/* Записали данные из каталога "/var/lib/postgreql/data" в домашний подкатолог "../mydata" */ 
      - /home/dudsmir/lab12/mydata:/var/lib/postgreql/data 	/* (из каталога "/home/dudsmir/lab12/mydata"). */
      
      
  /* Создаем контенер "pg_admin" */
  pg_admin:	/* Аналогично формируем записи для создания контейнера "pg_admin"*/
    container_name: pg_admin
    image: dpage/pgadmin4
    environment:
      PGADMIN_DEFAULT_EMAIL: "postgres@example.ru"
      PGADMIN_DEFAULT_PASSWORD: "pgadmin"
    ports: 
      - "5050:80"
    volumes:
      - ./pgadmin:/var/lib/pgadmin
    
```


> ### (2) Создание контейнра posgresql
> 
>> *docker* - это инструмент, с помощью которого можно легко запускать разные приложения   
>> в изолированных контейнерах на одном сервере.
>
>> **docker run --name pg_test -p 5432:5432 -e**    
>>> *run* - запустили (создали) контейнер.  
>>> *-p 5432:5432* - задали порты [локальный порт]:[внутри].    
>>> *--name pg_test* - создали контейнер с именем "pg_test".  
>>> *-e* - добавляет переменную окружения в контейнер.    
>>      
>> **POSTGRES_USER=postgres -e**  
>>> *POSTGRES_USER=[user name]* - создали пользователя с именем "postgres".  
>>    
>> **POSTGRES_PASSWORD=pgadmin -e**   
>>> *POSTGRES_PASSWORD=[user password]* - задали пароль пользователя "postgres".  
>>
>> **POSTGRES_DB=kitty -d postgres:13.3** 
>>> *POSTGRES_DB=[database name]* - назначили бд для контейнера с именем "kitty".  
>>> *-d [database]* - явно указали, на какой образе строится контейнер (с версией).  
>>
>> Создали контейнер "pg_test", который работает на образе postgres (версия - 13.3).


> ### (3) Создание контейнра pgadmin
> 
>> *docker* - это инструмент, с помощью которого можно легко запускать разные приложения   
>> в изолированных контейнерах на одном сервере.
>
>> **docker run --name pg_admin -p 5050:80 -e**    
>>> *run* - запустили (создали) контейнер.  
>>> *-p 5050:80* - задали порты [локальный порт]:[внутри].    
>>> *--name pg_admin* - создали контейнер с именем "pg_test".  
>>> *-e* - добавляет переменную окружения в контейнер.    
>>      
>> **PGADMIN_DEFAULT_EMAIL=postgres@example.ru -e**  
>>> *PGADMIN_DEFAULT_EMAIL=[user name]* - создали пользователя с почтой "postgres@example.ru" по умолчанию.  
>>    
>> **PGADMIN_DEFAULT_PASSWORD=pgadmin -e**   
>>> *PGADMIN_DEFAULT_PASSWORD=[user email password]* - задали пароль пользователя "postgres@example.ru" по умолчанию.  
>>
>> Создали контейнер "pg_admin", который работает на образе dpage/pgadmin4.  


> ### (4) Проверка работоспособности контейнеров pgadmin и posgresql
> 
> **docker ps** - посмотрели список всех активных контейнеров (их статус) (опция - *ps*).  
> После того, как убедились, что оба контейнера запущены и работают, подключаемся к pgadmin  
> через web-интерфейс и настраиваем подключение к служебной БД postgres.
> 
> **http:\\192.168.23.214:5050** - подключились к pgadmin через web-интерфейс, введя данную запись в адресную строку браузера.
>> Настройка БД (создание):  
>> General
>>> Name: localhost  
>>
>> Connection  
>>> Host name/address: 192.168.23.214  
>>> Port: 5432  
>>> Maintenance database: kitty  
>>> Username: postgres  
>>> Password: pgadmin


-----
#### Раздел 2. Ответы на вопросы
-----
#### Раздел 3. Выводы
-----

Таким образом, мы получить опыт в настройке Docker и работе с docker контейнерами.
